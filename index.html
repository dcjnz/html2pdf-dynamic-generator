<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Debug HTML2PDF</title>

  <!-- PDFMake i czcionki -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

  <!-- HTML to PDFMake (Uwaga: dzia≈Ça z unpkg, cdn czasem zawodzi) -->
  <script src="https://unpkg.com/html-to-pdfmake/browser.js"></script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="output" style="border: 2px dashed red; padding: 15px; margin: 15px;"></div>

  <script>
    const htmlEncoded = new URLSearchParams(window.location.search).get("html");

    if (!htmlEncoded) {
      document.body.innerHTML = "<p>‚ùå Brak parametru ?html=...</p>";
      throw new Error("Brak HTML");
    }

    const html = decodeURIComponent(htmlEncoded);
    const output = document.getElementById("output");

    // Dodaj testowy tekst przed i po
    output.innerHTML = `
      <p style="color:green;">‚úÖ TEST: Wczytano poczƒÖtek outputu</p>
      ${html}
      <p style="color:blue;">‚úÖ TEST: Wczytano koniec outputu</p>
    `;

    console.log("üîç Decoded HTML:", html);
    console.log("üì¶ Output innerHTML:", output.innerHTML);

    // Konwertuj HTML do struktury PDFMake
    let pdfmakeContent;
    try {
      pdfmakeContent = htmlToPdfmake(output.innerHTML, { window });
      console.log("‚úÖ Parsed PDFMake content:", pdfmakeContent);
    } catch (err) {
      console.error("‚ùå B≈ÇƒÖd podczas konwersji HTML do PDFMake:", err);
    }

    // Je≈õli PDFMake content powsta≈Ç ‚Äî otw√≥rz PDF
    if (pdfmakeContent && pdfmakeContent.length > 0) {
      pdfMake.createPdf({
        content: pdfmakeContent,
        defaultStyle: { font: 'Helvetica', fontSize: 11 }
      }).open();
    } else {
      console.warn("‚ö†Ô∏è Pusta zawarto≈õƒá PDF ‚Äî sprawd≈∫ HTML");
    }
  </script>
</body>
</html>
