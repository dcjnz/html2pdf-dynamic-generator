<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>PDF z HTML (kopiowalny tekst)</title>

  <!-- PDFMake -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

  <!-- HTML-to-PDFMake -->
  <script src="https://unpkg.com/html-to-pdfmake/browser.js"></script>

  <!-- Styl (opcjonalnie) -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="output" style="display: none;"></div>
  <div id="pdf-container" style="width:100%; height:100vh;"></div>

  <script>
    const htmlParam = new URLSearchParams(window.location.search).get("html");

    if (!htmlParam) {
      document.body.innerHTML = "<p>❗ Brak parametru ?html=...</p>";
      throw new Error("Brak danych HTML");
    }

    const html = decodeURIComponent(htmlParam);
    const output = document.getElementById("output");
    output.innerHTML = html;

    try {
      const pdfmakeContent = htmlToPdfmake(output.innerHTML, { window });

      const docDefinition = {
        content: pdfmakeContent,
        defaultStyle: {
          font: 'Helvetica',
          fontSize: 11
        }
      };

      pdfMake.createPdf(docDefinition).getDataUrl((dataUrl) => {
        const iframe = document.createElement('iframe');
        iframe.src = dataUrl;
        iframe.style.width = '100%';
        iframe.style.height = '100vh';
        iframe.style.border = 'none';
        document.getElementById("pdf-container").appendChild(iframe);
      });
    } catch (e) {
      console.error("❌ Błąd generowania PDF:", e);
      document.body.innerHTML = "<p style='color:red;'>❌ Wystąpił błąd podczas generowania PDF. Sprawdź dane HTML.</p>";
    }
  </script>
</body>
</html>
