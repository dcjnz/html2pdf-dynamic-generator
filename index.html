<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>PDF z kopiowalnym tekstem</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
<script>
  const dataParam = new URLSearchParams(window.location.search).get("data");
  if (!dataParam) {
    document.body.innerHTML = "<p style='padding:20px;'>❗ Brak parametru ?data=</p>";
    throw new Error("Brak danych");
  }

  const data = JSON.parse(decodeURIComponent(dataParam));

  const docDef = {
    content: [
      { text: data.title || "Oferta", style: "header" },

      {
        table: {
          widths: ["*", "auto", "auto", "auto"],
          body: [
            ["Przedmiot", "Cena", "Ilość", "Razem"],
            ...(data.items || []).map(i => [
              i.name, i.price, i.qty, i.total
            ])
          ]
        },
        margin: [0, 10, 0, 20]
      },

      ...(data.notes || []).map(note => ({ text: `• ${note}`, margin: [0, 0, 0, 5] })),

      { text: data.signature || "", margin: [0, 30, 0, 0] }
    ],
    styles: {
      header: {
        fontSize: 20,
        bold: true,
        alignment: "center",
        margin: [0, 0, 0, 10]
      }
    }
  };

  pdfMake.createPdf(docDef).open();
</script>
</body>
</html>
