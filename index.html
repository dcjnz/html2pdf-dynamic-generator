<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>PDF z HTML (kopiowalny tekst)</title>

  <!-- PDFMake -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

  <!-- HTML → PDFMake -->
  <script src="https://unpkg.com/html-to-pdfmake/browser.js"></script>

  <!-- (Opcjonalne) Twoje style dla #output -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body style="margin:0;">
  <div id="output" style="display:none;"></div>
  <iframe id="pdfFrame" style="width:100%; height:100vh; border:none;"></iframe>

  <script>
    const htmlParam = new URLSearchParams(window.location.search).get("html");
    if (!htmlParam) {
      document.body.innerHTML = "<p>❗ Brak parametru ?html=...</p>";
      throw new Error("Brak danych HTML");
    }

    const html = decodeURIComponent(htmlParam);
    const output = document.getElementById("output");
    output.innerHTML = html;

    let content;
    try {
      content = htmlToPdfmake(output.innerHTML, { window });
    } catch (err) {
      console.error("❌ Błąd konwersji HTML:", err);
      document.body.innerHTML = "<p style='color:red;'>Błąd konwersji HTML → PDFMake.</p>";
      throw err;
    }

    const docDefinition = {
      content,
      defaultStyle: {
        font: 'Helvetica',
        fontSize: 12
      }
    };

    pdfMake.createPdf(docDefinition).getDataUrl((dataUrl) => {
      const iframe = document.getElementById("pdfFrame");
      iframe.src = dataUrl;
    });
  </script>
</body>
</html>
